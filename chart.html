<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>লেবার চার্ট</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-3">
  <div class="d-flex align-items-center mb-3">
    <h4>লেবার চার্ট</h4>
    <div style="flex:1"></div>
    <a class="btn btn-sm btn-secondary" href="/">Back</a>
  </div>

  <canvas id="mainChart" height="120"></canvas>
  <p class="small mt-2">Chart shows daily aggregation of বাকী (baki) and জমা (jama).</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const API_BASE = "/api";
async function loadAndRender(){
  const res = await fetch(API_BASE + "/records");
  const data = await res.json();
  const records = data.records || [];

  // Aggregate by date
  const map = {};
  records.forEach(r=>{
    const d = r.date || 'Unknown';
    if(!map[d]) map[d] = { baki:0, jama:0 };
    map[d].baki += parseFloat(r.baki || 0);
    map[d].jama += parseFloat(r.jama || 0);
  });

  const labels = Object.keys(map).sort((a,b)=> new Date(a)-new Date(b));
  const baki = labels.map(l => map[l].baki);
  const jama = labels.map(l => map[l].jama);

  const ctx = document.getElementById('mainChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [
        { label: 'বাকী (Baki)', data: baki, tension: 0.3, fill:false },
        { label: 'জমা (Jama)', data: jama, tension: 0.3, fill:false }
      ]
    },
    options: {
      interaction: { mode: 'index', intersect: false },
      plugins: { legend: { position: 'top' } },
      scales: { x: { display: true }, y: { display: true } }
    }
  });
}

loadAndRender().catch(e=>{ console.error(e); alert("Failed to load chart"); });
</script>
</body>
</html>
